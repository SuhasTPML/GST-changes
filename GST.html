<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Next-Gen GST Reform – Interactive Infographic (DH, JS-enhanced)</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Roboto+Slab:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root{
  --dh-blue:#0091AC;
  --dh-blue-ink:#067991;
  --border:#e6e6e6;
  --ink:#1c1c1c;
  --muted:#6b6b6b;
  --bg-lite:#f7fafa;
  --red:#c1121f;
  --green:#2a9d8f;
  --drop:#e85d04;
  --radius:10px;
  --shadow:0 1px 2px rgba(0,0,0,.04);
}
*{box-sizing:border-box}
body{margin:0;background:#fff;}
.dh-gst-widget{
  font-family:"Roboto Slab", serif;
  color:var(--ink);
  background:#fff;
  border:1px solid var(--border);
  border-radius:var(--radius);
  max-width:860px;
  margin:16px auto;
  padding:16px;
  box-shadow:var(--shadow);
}
.dh-gst-title{
  margin:0;
  text-align:center;
  font-size:28px;
  line-height:1.2;
  color:var(--dh-blue);
  font-family:"Playfair Display", serif;
}
.dh-gst-kicker{
  text-align:center;
  color:var(--muted);
  margin:.25rem 0 1rem;
  font-size:14px;
}
.dh-card{
  background:var(--bg-lite);
  border:1px solid var(--border);
  border-radius:8px;
  padding:12px 12px;
  margin-bottom:16px;
}
.dh-block-title{
  margin:0 0 8px;
  color:var(--dh-blue-ink);
  font-weight:700;
  font-family:"Playfair Display", serif;
}
.dh-list{list-style:none;margin:0;padding:0;}
.dh-row{
  display:flex;
  justify-content:space-between;
  gap:16px;
  align-items:center;
  padding:10px 0;
  border-bottom:1px solid var(--border);
}
.dh-row:last-child{border-bottom:0;}
.dh-name{flex:1;font-weight:500;}
.dh-data{min-width:210px;text-align:right;white-space:nowrap;}
.old{color:var(--red);font-weight:700;}
.new{color:var(--green);font-weight:700;}
.drop{background:var(--drop);color:#fff;border-radius:999px;padding:3px 8px;font-size:12px;margin-left:6px}
details{border:1px solid var(--border);border-radius:8px;margin-bottom:12px;}
summary{
  list-style:none;
  cursor:pointer;
  padding:12px 14px;
  font-family:"Playfair Display", serif;
  font-weight:700;
  color:var(--dh-blue);
  position:relative;
}
summary::marker{display:none;}
summary::after{
  content:"▾";
  position:absolute;
  right:14px;
  transition:transform .3s ease;
}
details[open] summary{
  background:var(--dh-blue);
  color:#fff;
}
details[open] summary::after{transform:rotate(180deg);}
.dh-panel-inner{padding:8px 12px;}
.dh-gst-footer{
  margin-top:8px;
  padding-top:12px;
  border-top:2px solid var(--border);
  font-size:13px;
  color:var(--muted);
  text-align:left;
}
@media (max-width: 640px){
  .dh-gst-title{font-size:22px;}
  .dh-row{flex-direction:column;align-items:center;text-align:center;}
  .dh-name,.dh-data{width:100%;text-align:center;}
  .dh-data{min-width:auto;}
  .dh-gst-widget{border-left:none;border-right:none;border-radius:0;}
}
</style>
</head>
<body>

<div class="dh-gst-widget">
  <h2 class="dh-gst-title">Next-Gen GST Reform</h2>
  <p class="dh-gst-kicker">Historic Diwali Gift • Better &amp; Simpler</p>

  <!-- Highlights -->
  <section class="dh-card" aria-label="Most impactful changes">
    <h3 class="dh-block-title">Most Impactful Changes</h3>
    <ul class="dh-list">
      <li class="dh-row"><span class="dh-name">🛡️ Health &amp; Life Insurance</span><span class="dh-data"><span class="old">18%</span> → <span class="new">0%</span> <span class="drop">↓18 pp</span></span></li>
      <li class="dh-row"><span class="dh-name">🚜 Tractor Tyres &amp; Parts</span><span class="dh-data"><span class="old">18%</span> → <span class="new">5%</span> <span class="drop">↓13 pp</span></span></li>
      <li class="dh-row"><span class="dh-name">👓 Corrective Spectacles</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
      <li class="dh-row"><span class="dh-name">🍿 Namkeens &amp; Mixtures</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
    </ul>
  </section>

  <!-- Essentials -->
  <details open>
    <summary>🏠 Daily Essentials</summary>
    <div class="dh-panel-inner">
      <ul class="dh-list">
        <li class="dh-row"><span class="dh-name">🧴 Hair Oil, Shampoo, Soap</span><span class="dh-data"><span class="old">18%</span> → <span class="new">5%</span> <span class="drop">↓13 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🧈 Butter, Ghee, Cheese</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🍿 Namkeens &amp; Mixtures</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🍲 Utensils</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🍼 Feeding Bottles, Diapers</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🧵 Sewing Machines</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
      </ul>
    </div>
  </details>

  <!-- Healthcare -->
  <details>
    <summary>💊 Healthcare Relief</summary>
    <div class="dh-panel-inner">
      <ul class="dh-list">
        <li class="dh-row"><span class="dh-name">🛡️ Health &amp; Life Insurance</span><span class="dh-data"><span class="old">18%</span> → <span class="new">0%</span> <span class="drop">↓18 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🌡️ Thermometer</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">💨 Medical Oxygen</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🧪 Diagnostic Kits</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">📊 Glucometer &amp; Test Strips</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">👓 Corrective Spectacles</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
      </ul>
    </div>
  </details>

  <!-- Agriculture -->
  <details>
    <summary>🚜 Farmers &amp; Agriculture</summary>
    <div class="dh-panel-inner">
      <ul class="dh-list">
        <li class="dh-row"><span class="dh-name">🚜 Tractor Tyres &amp; Parts</span><span class="dh-data"><span class="old">18%</span> → <span class="new">5%</span> <span class="drop">↓13 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🚜 Tractors</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🌱 Bio-Pesticides, Micro-Nutrients</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">💧 Drip Irrigation &amp; Sprinklers</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🌾 Harvesting Machines</span><span class="dh-data"><span class="old">12%</span> → <span class="new">5%</span> <span class="drop">↓7 pp</span></span></li>
      </ul>
    </div>
  </details>

  <!-- Education -->
  <details>
    <summary>📚 Education</summary>
    <div class="dh-panel-inner">
      <ul class="dh-list">
        <li class="dh-row"><span class="dh-name">🗺️ Maps, Charts, Globes</span><span class="dh-data"><span class="old">12%</span> → <span class="new">0%</span> <span class="drop">↓12 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">✏️ Pencils, Crayons, Sharpeners</span><span class="dh-data"><span class="old">12%</span> → <span class="new">0%</span> <span class="drop">↓12 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">📓 Notebooks &amp; Exercise Books</span><span class="dh-data"><span class="old">12%</span> → <span class="new">0%</span> <span class="drop">↓12 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🩶 Erasers</span><span class="dh-data"><span class="old">5%</span> → <span class="new">0%</span> <span class="drop">↓5 pp</span></span></li>
      </ul>
    </div>
  </details>

  <!-- Vehicles -->
  <details>
    <summary>🚗 Vehicles Made Affordable</summary>
    <div class="dh-panel-inner">
      <ul class="dh-list">
        <li class="dh-row"><span class="dh-name">🚗 Petrol/LPG/CNG Cars (≤1200cc)</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🚙 Diesel Hybrid Cars (≤1500cc)</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🛺 3-Wheelers</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🏍️ Motorcycles (≤350cc)</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🚚 Goods Transport Vehicles</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
      </ul>
    </div>
  </details>

  <!-- Electronics -->
  <details>
    <summary>📺 Electronics</summary>
    <div class="dh-panel-inner">
      <ul class="dh-list">
        <li class="dh-row"><span class="dh-name">❄️ Air Conditioners</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">📺 TVs above 32&quot;</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🖥️ Monitors &amp; Projectors</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
        <li class="dh-row"><span class="dh-name">🍽️ Dish Washing Machines</span><span class="dh-data"><span class="old">28%</span> → <span class="new">18%</span> <span class="drop">↓10 pp</span></span></li>
      </ul>
    </div>
  </details>

  <div id="gst-root"></div>

  <!-- Embedded GST dataset (self-contained). Replace array with your gst.json content. -->
  <script id="gst-data" type="application/json">{
  "🚜 Agriculture": [
    {
      "description": "Bio-Pesticides, Micro-Nutrients",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Drip Irrigation & Sprinklers",
      "from": 12,
      "to": 5,
      "change_pp": -7
    }
  ],
  "👕 Apparel & Accessories": [
    {
      "description": "Apparel over Rs 2,500",
      "from": 12,
      "to": 18,
      "change_pp": 6
    },
    {
      "description": "Footwear less than Rs.2500 per pair",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Handbags",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Handmade/hand embroidered shawls",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Umbrellas",
      "from": 12,
      "to": 5,
      "change_pp": -7
    }
  ],
  "🚗 Automotive": [
    {
      "description": "3-Wheelers",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Ambulances",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Bodies for the motor vehicles",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Bumpers and parts thereof for tractors",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Diesel cars of engine capacity not exceeding 1500 cc and of length not exceeding 4000 mm",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Goods Transport Vehicles",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Motor cars other",
      "from": 28,
      "to": 40,
      "change_pp": 12
    },
    {
      "description": "Motorcycles",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Petrol cars of engine capacity not exceeding 1200cc and of length not exceeding 4000 mm",
      "from": 28,
      "to": 18,
      "change_pp": -10
    }
  ],
  "🍔 Food & Beverages": [
    {
      "description": "Aerated beverages containing sugar",
      "from": 28,
      "to": 40,
      "change_pp": 12
    },
    {
      "description": "All goods incl. refined sugar containing added flavouring or colouring matter, sugar cubes",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Beverages containing milk",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Butter, Ghee, Cheese",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Chocolates and other food preparations",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Coffee",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Condensed milk",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Confectionery",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Dates",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Diabetic foods",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Fish and caviar, prepared and preserved",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Ice cream",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Jams and fruit jellies",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Mustard, mayonnaise",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Namkeens & Mixtures",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Paneer of chenna",
      "from": 5,
      "to": 0,
      "change_pp": -5
    },
    {
      "description": "Paratha, parotta and other Indian breads by any name called",
      "from": 18,
      "to": 0,
      "change_pp": -18
    },
    {
      "description": "Pasta",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Pastry, cakes, biscuits bread",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Pizza bread",
      "from": 5,
      "to": 0,
      "change_pp": -5
    },
    {
      "description": "Plant-based milk",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Shrimps and prawns, prepared and preserved",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Soups and broth",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Tender coconut water",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Waters, including natural or artificial mineral waters and aerated waters",
      "from": 18,
      "to": 5,
      "change_pp": -13
    }
  ],
  "🏠 Household Goods": [
    {
      "description": "Agarbatti",
      "from": 12,
      "to": 18,
      "change_pp": 6
    },
    {
      "description": "Candles, tapers and the like",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Monitors & Projectors",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "TVs above 32\"",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Utensils",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Wood, stone idols",
      "from": 12,
      "to": 5,
      "change_pp": -7
    }
  ],
  "💎 Luxury & Sin Goods": [
    {
      "description": "Bidis",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Cigars and cigarettes",
      "from": 28,
      "to": 40,
      "change_pp": 12
    },
    {
      "description": "Pan masala",
      "from": 28,
      "to": 40,
      "change_pp": 12
    },
    {
      "description": "Revolvers and pistols",
      "from": 28,
      "to": 40,
      "change_pp": 12
    },
    {
      "description": "Smoking pipes",
      "from": 28,
      "to": 40,
      "change_pp": 12
    }
  ],
  "⚕️ Medical & Health": [
    {
      "description": "All diagnostic kits",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Bandages, dressing",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Frames and mountings for spectacles, goggles or the like, and parts thereof",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Glucometer & Test Strips",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Health & Life Insurance",
      "from": 18,
      "to": 0,
      "change_pp": -18
    },
    {
      "description": "Medical Oxygen",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Retail medicines",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Thermometer",
      "from": 12,
      "to": 5,
      "change_pp": -7
    }
  ],
  "✨ Miscellaneous": [
    {
      "description": "Bicycles and other cycles (including delivery tricycles), not motorized",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Caffeinated beverages",
      "from": 28,
      "to": 40,
      "change_pp": 12
    },
    {
      "description": "Hybrids with engine capacity not exceeding 1200cc and of length not exceeding 4000 mm",
      "from": 28,
      "to": 18,
      "change_pp": -10
    },
    {
      "description": "Non-alcoholic beverages",
      "from": 18,
      "to": 40,
      "change_pp": 22
    }
  ],
  "🧼 Personal Care": [
    {
      "description": "Combs, hair pins",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Dental floss, toothpaste",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Feeding Bottles, Diapers",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Hair Oil, Shampoo, Soap",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Shaving cream, shaving lotion, aftershave lotion",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Toilet Soap",
      "from": 18,
      "to": 5,
      "change_pp": -13
    },
    {
      "description": "Tooth powder",
      "from": 12,
      "to": 5,
      "change_pp": -7
    }
  ],
  "☀️ Renewable Energy": [
    {
      "description": "PV cells",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Silicon wafers",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Wind mills",
      "from": 12,
      "to": 5,
      "change_pp": -7
    }
  ],
  "✏️ Stationery & School Supplies": [
    {
      "description": "Erasers",
      "from": 5,
      "to": 0,
      "change_pp": -5
    },
    {
      "description": "Exercise book, graph book, & laboratory notebook and notebooks",
      "from": 12,
      "to": 0,
      "change_pp": -12
    },
    {
      "description": "Maps",
      "from": 12,
      "to": 0,
      "change_pp": -12
    },
    {
      "description": "Mathematical boxes, geometry boxes and colour boxes",
      "from": 12,
      "to": 5,
      "change_pp": -7
    },
    {
      "description": "Pencils, Crayons, Sharpeners",
      "from": 12,
      "to": 0,
      "change_pp": -12
    }
  ]
}</script>

  <footer class="dh-gst-footer">
    <span>Source: Government of India (CBIC)</span>
  </footer>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const accordions = document.querySelectorAll("details");
  const SCROLL_OFFSET = 100; // px

  accordions.forEach(acc => {
    acc.addEventListener("toggle", () => {
      if (acc.open) {
        // Close others
        accordions.forEach(o => { if (o !== acc) o.removeAttribute("open"); });
        // Scroll with offset so the summary sits a bit below the top edge
        setTimeout(() => {
          const rect = acc.getBoundingClientRect();
          const y = rect.top + window.scrollY - SCROLL_OFFSET;
          window.scrollTo({ top: y, behavior: "smooth" });
        }, 150);
      }
    });
  });
});
</script>

<!-- Dynamic renderer: reads embedded GST JSON and builds the page; removes legacy lists on success. -->
<script>
(function(){
  const dataEl = document.getElementById('gst-data');
  const root = document.getElementById('gst-root');
  const widget = document.querySelector('.dh-gst-widget');
  if(!dataEl || !root || !widget) return;
  let items = [];
  try {
    items = JSON.parse(dataEl.textContent || '[]');
  } catch(e){ console.error('Failed to parse embedded GST JSON', e); return; }
  if(!Array.isArray(items)){
    if(items && typeof items === 'object'){
      items = Object.entries(items).flatMap(([sector, list]) => Array.isArray(list) ? list.map(it => Object.assign({ sector }, it)) : []);
    } else { items = []; }
  }
  if(items.length === 0) return;

  function compute(it){
    const from = Number(it.from);
    const to = Number(it.to);
    const change = Number.isFinite(it.change_pp) ? Number(it.change_pp) : (to - from);
    const trend = it.trend ? String(it.trend) : (change > 0 ? 'expensive' : change < 0 ? 'cheaper' : 'no_change');
    return Object.assign({}, it, { from, to, change_pp: change, trend });
  }
  items = items.map(compute);

  const groups = { cheaper: [], expensive: [], no_change: [] };
  items.forEach(i => { (groups[i.trend] || groups.no_change).push(i); });

  function row(it){
    const li = document.createElement('li'); li.className = 'dh-row';
    const name = document.createElement('span'); name.className = 'dh-name'; name.textContent = it.description;
    const data = document.createElement('span'); data.className = 'dh-data';
    const delta = (it.change_pp >= 0 ? '+' : '') + it.change_pp + ' pp';
    data.innerHTML = `<span class="old">${it.from}%</span> → <span class="new">${it.to}%</span> <span class="drop">${delta}</span>`;
    li.append(name, data);
    return li;
  }

  function card(title, arr){
    if(!arr || arr.length === 0) return null;
    const wrap = document.createElement('div'); wrap.className = 'dh-card';
    const h = document.createElement('h3'); h.className = 'dh-block-title'; h.textContent = title;
    const ul = document.createElement('ul'); ul.className = 'dh-list';
    arr.slice().sort((a,b)=>Math.abs(b.change_pp) - Math.abs(a.change_pp)).forEach(i=>ul.appendChild(row(i)));
    wrap.append(h, ul);
    return wrap;
  }

  const summary = document.createElement('div'); summary.className = 'dh-card';
  const sh = document.createElement('h3'); sh.className = 'dh-block-title'; sh.textContent = 'GST Changes Summary';
  const p = document.createElement('p'); p.textContent = `Cheaper: ${groups.cheaper.length} • Expensive: ${groups.expensive.length}`;
  summary.append(sh, p);
  root.append(summary);

  const cheaperCard = card('Cheaper', groups.cheaper);
  const expensiveCard = card('Expensive', groups.expensive);
  if (cheaperCard) root.appendChild(cheaperCard);
  if (expensiveCard) root.appendChild(expensiveCard);

  // Remove legacy static content after successful render
  widget.querySelectorAll('details, section').forEach(n => n.remove());
})();
</script>

<!-- Enhanced renderer with filters and sorting using embedded JSON -->
<script>
(function(){
  const dataEl = document.getElementById('gst-data');
  const root = document.getElementById('gst-root');
  const widget = document.querySelector('.dh-gst-widget');
  if(!dataEl || !root || !widget) return;
  let items = [];
  try { items = JSON.parse(dataEl.textContent || '[]'); } catch(e){ return; }
  // Accept either a flat array or a grouped object { sector: [items] }
  if(!Array.isArray(items)){
    if(items && typeof items === 'object'){
      items = Object.entries(items)
        .flatMap(([sector, list]) => Array.isArray(list) ? list.map(it => Object.assign({ sector }, it)) : []);
    } else { items = []; }
  }
  if(items.length === 0) return;

  function compute(it){
    const from = Number(it.from);
    const to = Number(it.to);
    const change = Number.isFinite(it.change_pp) ? Number(it.change_pp) : (to - from);
    const trend = it.trend ? String(it.trend) : (change > 0 ? 'expensive' : change < 0 ? 'cheaper' : 'no_change');
    return Object.assign({}, it, { from, to, change_pp: change, trend });
  }
  items = items.map(compute);

  const hasSectors = items.some(i => i.sector);
  const sectors = Array.from(new Set(items.map(i => i.sector).filter(Boolean))).sort();
  const qs = new URLSearchParams(location.search);
  const state = {
    q: (qs.get('q') || '').trim(),
    trend: qs.get('trend') || 'all',
    sector: qs.get('sector') || 'all',
    sort: qs.get('sort') || 'change_desc'
  };
  function writeState(){
    const next = new URL(location.href);
    const p = new URLSearchParams();
    if(state.q) p.set('q', state.q);
    if(state.trend && state.trend !== 'all') p.set('trend', state.trend);
    if(hasSectors && state.sector && state.sector !== 'all') p.set('sector', state.sector);
    if(state.sort && state.sort !== 'change_desc') p.set('sort', state.sort);
    next.search = p.toString();
    history.replaceState(null, '', next);
  }

  function el(tag, cls, text){ const n=document.createElement(tag); if(cls) n.className=cls; if(text!=null) n.textContent=text; return n; }
  function row(it){
    const li = el('li','dh-row');
    const name = el('span','dh-name', it.description);
    const data = el('span','dh-data');
    const delta = (it.change_pp >= 0 ? '+' : '') + it.change_pp + ' pp';
    data.innerHTML = `<span class="old">${it.from}%</span> &rarr; <span class="new">${it.to}%</span> <span class="drop">${delta}</span>`;
    li.append(name,data);
    return li;
  }
  function filterItems(){
    const q = state.q.toLowerCase();
    return items.filter(i=>{
      if(state.trend !== 'all' && i.trend !== state.trend) return false;
      if(hasSectors && state.sector !== 'all' && (i.sector||'') !== state.sector) return false;
      if(q && !(i.description||'').toLowerCase().includes(q)) return false;
      return true;
    });
  }
  const cmp = {
    change_desc:(a,b)=> Math.abs(b.change_pp) - Math.abs(a.change_pp),
    change_asc:(a,b)=> Math.abs(a.change_pp) - Math.abs(b.change_pp),
    to_desc:(a,b)=> b.to - a.to,
    to_asc:(a,b)=> a.to - b.to,
    from_desc:(a,b)=> b.from - a.from,
    from_asc:(a,b)=> a.from - b.from,
    az:(a,b)=> (a.description||'').localeCompare(b.description||''),
    za:(a,b)=> (b.description||'').localeCompare(a.description||'')
  };
  function card(title, arr){
    if(!arr || arr.length===0) return null;
    const wrap = el('div','dh-card');
    const h = el('h3','dh-block-title', title);
    const ul = el('ul','dh-list');
    arr.slice().sort(cmp[state.sort]||cmp.change_desc).forEach(i=>ul.appendChild(row(i)));
    wrap.append(h,ul); return wrap;
  }
  function buildToolbar(){
    const card = el('div','dh-card');
    const h = el('h3','dh-block-title','Filters & Sorting');
    const wrap = el('div');
    const search = el('input'); search.type='search'; search.placeholder='Search items'; search.value=state.q; search.style.marginRight='8px';
    const trend = el('select'); ['all','cheaper','expensive'].forEach(v=>{ const o=el('option',null,v); o.value=v; o.selected=(v===state.trend); trend.appendChild(o); }); trend.style.marginRight='8px';
    let sectorSel=null; if(hasSectors){ sectorSel = el('select'); sectorSel.style.marginRight='8px'; sectorSel.appendChild(new Option('all','all',false,state.sector==='all')); sectors.forEach(s=> sectorSel.appendChild(new Option(s,s,false,state.sector===s))); }
    const sort = el('select'); [['change_desc','Δ pp (desc)'],['change_asc','Δ pp (asc)'],['to_desc','New % (desc)'],['to_asc','New % (asc)'],['from_desc','Old % (desc)'],['from_asc','Old % (asc)'],['az','A→Z'],['za','Z→A']].forEach(([val,label])=>{ const o=el('option',null,label); o.value=val; o.selected=(val===state.sort); sort.appendChild(o); });
    let t; search.addEventListener('input',()=>{ clearTimeout(t); t=setTimeout(()=>{ state.q=search.value.trim(); writeState(); render(); },200); });
    trend.addEventListener('change',()=>{ state.trend=trend.value; writeState(); render(); });
    if(sectorSel) sectorSel.addEventListener('change',()=>{ state.sector=sectorSel.value; writeState(); render(); });
    sort.addEventListener('change',()=>{ state.sort=sort.value; writeState(); render(); });
    wrap.append(search,trend); if(sectorSel) wrap.append(sectorSel); wrap.append(sort);
    card.append(h,wrap); return card;
  }
  function buildSummary(list){
    const s=el('div','dh-card'); const h=el('h3','dh-block-title','GST Changes Summary');
    const cheaper = list.filter(i=>i.trend==='cheaper').length; const expensive=list.filter(i=>i.trend==='expensive').length;
    const p=el('p',null,`Cheaper: ${cheaper} • Expensive: ${expensive}`); s.append(h,p); return s;
  }
  function render(){
    root.innerHTML=''; const filtered = filterItems(); root.appendChild(buildSummary(filtered)); root.appendChild(buildToolbar());
    const byTrend = filtered.reduce((acc,it)=>{ (acc[it.trend]||(acc[it.trend]=[])).push(it); return acc; },{});
    if(state.trend==='cheaper' || state.trend==='all'){ const c=card('Cheaper', byTrend.cheaper||[]); if(c) root.appendChild(c); }
    if(state.trend==='expensive' || state.trend==='all'){ const c=card('Expensive', byTrend.expensive||[]); if(c) root.appendChild(c); }
  }
  render();
  // Remove legacy static content after enhanced render
  widget.querySelectorAll('details, section').forEach(n=>n.remove());
})();
</script>

</body>
</html>
